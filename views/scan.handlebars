<h2>Scan Ticket QR Code</h2>
<div id="reader" style="width: 300px"></div>
<p id="result"></p>

<script>
  function onScanSuccess(decodedText, decodedResult) {
    console.log(`QR Code detected: ${decodedText}`);
    document.getElementById("result").innerText = "Validating...";

    // Redirect to validate route
    window.location.href = `/validate/${decodedText}`;
  }

  const html5QrCode = new Html5Qrcode("reader");

  Html5Qrcode.getCameras().then(devices => {
    if (devices && devices.length) {
      html5QrCode.start(
        { facingMode: "environment" }, // rear camera
        {
          fps: 10,
          qrbox: 250
        },
        onScanSuccess
      );
    }
  }).catch(err => {
    console.error("Camera error:", err);
    document.getElementById("result").innerText = "Camera access error!";
  });
</script>
